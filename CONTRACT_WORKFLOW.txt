/*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        CONTRACT WORKFLOW DIAGRAM                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STEP 1: PROPOSAL ACCEPTANCE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    CLIENT                                SERVER                         DATABASE
      â”‚                                     â”‚                                â”‚
      â”œâ”€â”€â–º Accept Proposal                 â”‚                                â”‚
      â”‚    POST /api/proposals/:id/accept  â”‚                                â”‚
      â”‚                                     â”œâ”€â”€â”€â–º Update proposal status     â”‚
      â”‚                                     â”‚     status = 'accepted'        â”œâ”€â”€â–º Proposals
      â”‚    âœ… Proposal Accepted â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                â”‚    Collection
      â”‚                                     â”‚                                â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STEP 2: AI CONTRACT GENERATION                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    CLIENT                                SERVER                         AI SERVICE
      â”‚                                     â”‚                                â”‚
      â”œâ”€â”€â–º Generate Contract               â”‚                                â”‚
      â”‚    POST /contracts/generate/:id    â”‚                                â”‚
      â”‚                                     â”œâ”€â”€â”€â–º Fetch proposal & project  â”‚
      â”‚                                     â”œâ”€â”€â”€â–º Build contract data       â”‚
      â”‚                                     â”‚                                â”‚
      â”‚                                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
      â”‚                                     â”‚   Google Gemini API            â”‚
      â”‚                                     â”‚   "Generate professional       â”‚
      â”‚                                     â”‚    contract for..."            â”‚
      â”‚                                     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                                     â”‚   AI-generated contract        â”‚
      â”‚                                     â”‚                                â”‚
      â”‚                                     â”œâ”€â”€â”€â–º Save to database           â”‚
      â”‚                                     â”‚     Contract {                 â”‚
      â”‚                                     â”‚       contractText,            â”‚
      â”‚                                     â”‚       milestones,              â”‚
      â”‚                                     â”‚       status: 'pending'        â”‚
      â”‚                                     â”‚     }                          â”‚
      â”‚                                     â”‚                                â”‚
      â”‚    ğŸ“„ Contract Created â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                â”‚
      â”‚    Navigate to /contract/:id       â”‚                                â”‚
      â”‚                                     â”‚                                â”‚
      â”‚                    ğŸ”” Socket.IO Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º        â”‚
      â”‚                    "contractGenerated"                        FREELANCER


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STEP 3: DIGITAL SIGNATURES                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    CLIENT                                SERVER                       FREELANCER
      â”‚                                     â”‚                                â”‚
      â”œâ”€â”€â–º View Contract                   â”‚                                â”‚
      â”‚    GET /contracts/:id              â”‚                                â”‚
      â”‚    âœ… Contract Displayed            â”‚                                â”‚
      â”‚                                     â”‚                                â”‚
      â”œâ”€â”€â–º Sign Contract                   â”‚                                â”‚
      â”‚    POST /contracts/:id/accept      â”‚                                â”‚
      â”‚    { signature: "John Doe" }       â”‚                                â”‚
      â”‚                                     â”œâ”€â”€â”€â–º Update contract:           â”‚
      â”‚                                     â”‚     clientAccepted = true      â”‚
      â”‚                                     â”‚     clientSignature = "..."    â”‚
      â”‚                                     â”‚     status = 'partially_signed'â”‚
      â”‚                                     â”‚                                â”‚
      â”‚    âœ… Signed â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                â”‚
      â”‚                    ğŸ”” Socket.IO Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º        â”‚
      â”‚                    "contractSigned by client"                        â”‚
      â”‚                                     â”‚                                â”‚
      â”‚                                     â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
      â”‚                                     â”‚  POST /contracts/:id/accept    â”‚
      â”‚                                     â”‚  { signature: "Jane Smith" }   â”‚
      â”‚                                     â”‚                                â”‚
      â”‚                                     â”œâ”€â”€â”€â–º Update contract:           â”‚
      â”‚                                     â”‚     freelancerAccepted = true  â”‚
      â”‚                                     â”‚     status = 'fully_signed'    â”‚
      â”‚                                     â”‚     milestone[0].status =      â”‚
      â”‚                                     â”‚       'in_progress'            â”‚
      â”‚                                     â”‚                                â”‚
      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ”” Socket.IO Notification                         â”‚
      â”‚    "contractSigned by freelancer - fully executed!"                 â”‚
      â”‚                                     â”‚                                â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 4: MILESTONE COMPLETION                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  FREELANCER                             SERVER                          CLIENT
      â”‚                                     â”‚                                â”‚
      â”‚   ğŸ”¨ Works on project...           â”‚                                â”‚
      â”‚                                     â”‚                                â”‚
      â”œâ”€â”€â–º Mark Milestone Complete         â”‚                                â”‚
      â”‚    POST /contracts/:id/             â”‚                                â”‚
      â”‚         milestone/0/complete        â”‚                                â”‚
      â”‚                                     â”‚                                â”‚
      â”‚                                     â”œâ”€â”€â”€â–º Update milestone:          â”‚
      â”‚                                     â”‚     status = 'completed'       â”‚
      â”‚                                     â”‚     completedAt = Date.now()   â”‚
      â”‚                                     â”‚                                â”‚
      â”‚    âœ… Milestone Marked Complete     â”‚                                â”‚
      â”‚                    ğŸ”” Socket.IO Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º        â”‚
      â”‚                    "milestoneCompleted - ready for payment"          â”‚
      â”‚                                     â”‚                                â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 5: PAYPAL PAYMENT FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    CLIENT                    SERVER              PAYPAL API          FREELANCER
      â”‚                         â”‚                      â”‚                   â”‚
      â”œâ”€â”€â–º Create PayPal Order â”‚                      â”‚                   â”‚
      â”‚    POST /paypal/        â”‚                      â”‚                   â”‚
      â”‚         create-order    â”‚                      â”‚                   â”‚
      â”‚    {                    â”‚                      â”‚                   â”‚
      â”‚      amount: 333.33,    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
      â”‚      contractId,        â”‚  POST /v2/checkout/  â”‚                   â”‚
      â”‚      milestoneIndex: 0  â”‚       orders         â”‚                   â”‚
      â”‚    }                    â”‚                      â”‚                   â”‚
      â”‚                         â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                   â”‚
      â”‚    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  { orderId,          â”‚                   â”‚
      â”‚    { orderId,           â”‚    approvalUrl }     â”‚                   â”‚
      â”‚      approvalUrl }      â”‚                      â”‚                   â”‚
      â”‚                         â”‚                      â”‚                   â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                   â”‚
      â”‚         Redirect to PayPal approval URL        â”‚                   â”‚
      â”‚         (User logs in and confirms payment)    â”‚                   â”‚
      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
      â”‚         Payment approved, return to site       â”‚                   â”‚
      â”‚                         â”‚                      â”‚                   â”‚
      â”œâ”€â”€â–º Capture Payment      â”‚                      â”‚                   â”‚
      â”‚    POST /paypal/        â”‚                      â”‚                   â”‚
      â”‚         capture-order   â”‚                      â”‚                   â”‚
      â”‚    { orderId }          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
      â”‚                         â”‚  POST /v2/checkout/  â”‚                   â”‚
      â”‚                         â”‚       orders/:id/    â”‚                   â”‚
      â”‚                         â”‚       capture        â”‚                   â”‚
      â”‚                         â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                   â”‚
      â”‚    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  { status: COMPLETED,â”‚                   â”‚
      â”‚    { success: true,     â”‚    capture_id,       â”‚                   â”‚
      â”‚      captureId,         â”‚    payer_id }        â”‚                   â”‚
      â”‚      amount,            â”‚                      â”‚                   â”‚
      â”‚      payerId }          â”‚                      â”‚                   â”‚
      â”‚                         â”‚                      â”‚                   â”‚
      â”œâ”€â”€â–º Record Payment       â”‚                      â”‚                   â”‚
      â”‚    POST /contracts/:id/ â”‚                      â”‚                   â”‚
      â”‚         milestone/0/pay â”‚                      â”‚                   â”‚
      â”‚    {                    â”‚                      â”‚                   â”‚
      â”‚      paymentId,         â”œâ”€â”€â”€â–º Update:          â”‚                   â”‚
      â”‚      paypalOrderId,     â”‚     milestone[0]:    â”‚                   â”‚
      â”‚      paypalPayerId      â”‚       status = 'paid'â”‚                   â”‚
      â”‚    }                    â”‚       paidAt = now   â”‚                   â”‚
      â”‚                         â”‚       paymentId      â”‚                   â”‚
      â”‚                         â”‚     totalPaid += amt â”‚                   â”‚
      â”‚                         â”‚                      â”‚                   â”‚
      â”‚    âœ… Payment Recorded  â”‚                      â”‚                   â”‚
      â”‚                    ğŸ”” Socket.IO Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º        â”‚
      â”‚                    "paymentReceived - $333.33 paid"                â”‚
      â”‚                         â”‚                      â”‚                   â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STEP 6: REPEAT FOR ALL MILESTONES                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Freelancer â†’ Complete Milestone 2 â†’ Client Pays â†’ ... â†’ Complete Milestone N
    
    When all milestones paid:
    â”œâ”€â”€â–º Contract status = 'completed'
    â””â”€â”€â–º totalPaid = paymentAmount âœ…


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            DATABASE STRUCTURE                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

contracts (Collection)
â”œâ”€â”€ _id: ObjectId
â”œâ”€â”€ proposalId: ObjectId â”€â”€â”€â”€â–º proposals._id
â”œâ”€â”€ projectId: ObjectId â”€â”€â”€â”€â”€â–º projects._id
â”œâ”€â”€ clientId: ObjectId â”€â”€â”€â”€â”€â”€â–º users._id
â”œâ”€â”€ freelancerId: ObjectId â”€â”€â–º users._id
â”‚
â”œâ”€â”€ contractText: String (AI-generated full contract)
â”œâ”€â”€ projectScope: String
â”œâ”€â”€ deliverables: [String]
â”œâ”€â”€ paymentAmount: Number
â”œâ”€â”€ paymentTerms: String
â”œâ”€â”€ timeline: String
â”‚
â”œâ”€â”€ clientAccepted: Boolean
â”œâ”€â”€ clientAcceptedAt: Date
â”œâ”€â”€ clientSignature: String
â”œâ”€â”€ clientIpAddress: String
â”‚
â”œâ”€â”€ freelancerAccepted: Boolean
â”œâ”€â”€ freelancerAcceptedAt: Date
â”œâ”€â”€ freelancerSignature: String
â”œâ”€â”€ freelancerIpAddress: String
â”‚
â”œâ”€â”€ status: Enum['pending', 'partially_signed', 'fully_signed', 'completed']
â”‚
â”œâ”€â”€ milestones: [
â”‚   {
â”‚     description: String,
â”‚     amount: Number,
â”‚     dueDate: Date,
â”‚     status: Enum['pending', 'in_progress', 'completed', 'paid'],
â”‚     completedAt: Date,
â”‚     paidAt: Date,
â”‚     paymentId: String
â”‚   }
â”‚ ]
â”‚
â”œâ”€â”€ totalPaid: Number
â”œâ”€â”€ paymentMethod: String ('paypal')
â”œâ”€â”€ paypalOrderId: String
â”œâ”€â”€ paypalPayerId: String
â”‚
â”œâ”€â”€ createdAt: Date (auto)
â””â”€â”€ updatedAt: Date (auto)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              API ENDPOINTS                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CONTRACT ROUTES (/api/contracts)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST   /generate/:proposalId                                                 â”‚
â”‚        â†³ Generate AI contract for accepted proposal                          â”‚
â”‚        â†³ Auth: Required (client or freelancer)                               â”‚
â”‚        â†³ Returns: { contract }                                               â”‚
â”‚                                                                               â”‚
â”‚ GET    /:contractId                                                           â”‚
â”‚        â†³ Get contract details                                                â”‚
â”‚        â†³ Auth: Required (contract parties only)                              â”‚
â”‚        â†³ Returns: { contract (populated) }                                   â”‚
â”‚                                                                               â”‚
â”‚ GET    /proposal/:proposalId                                                  â”‚
â”‚        â†³ Get contract by proposal ID                                         â”‚
â”‚        â†³ Auth: Required (contract parties only)                              â”‚
â”‚        â†³ Returns: { contract }                                               â”‚
â”‚                                                                               â”‚
â”‚ POST   /:contractId/accept                                                    â”‚
â”‚        â†³ Sign contract (client or freelancer)                                â”‚
â”‚        â†³ Body: { signature: String }                                         â”‚
â”‚        â†³ Auth: Required                                                      â”‚
â”‚        â†³ Returns: { contract, fullyExecuted: Boolean }                       â”‚
â”‚                                                                               â”‚
â”‚ POST   /:contractId/milestone/:milestoneIndex/complete                       â”‚
â”‚        â†³ Mark milestone as completed                                         â”‚
â”‚        â†³ Auth: Required (freelancer only)                                    â”‚
â”‚        â†³ Returns: { milestone }                                              â”‚
â”‚                                                                               â”‚
â”‚ POST   /:contractId/milestone/:milestoneIndex/pay                            â”‚
â”‚        â†³ Record payment for milestone                                        â”‚
â”‚        â†³ Body: { paymentId, paypalOrderId, paypalPayerId }                   â”‚
â”‚        â†³ Auth: Required (client only)                                        â”‚
â”‚        â†³ Returns: { contract, completed: Boolean }                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PAYPAL ROUTES (/api/paypal)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET    /config                                                                â”‚
â”‚        â†³ Get PayPal client ID for frontend                                   â”‚
â”‚        â†³ Auth: None                                                           â”‚
â”‚        â†³ Returns: { clientId, currency }                                     â”‚
â”‚                                                                               â”‚
â”‚ POST   /create-order                                                          â”‚
â”‚        â†³ Create PayPal payment order                                         â”‚
â”‚        â†³ Body: { amount, currency, description, contractId, milestoneIndex } â”‚
â”‚        â†³ Auth: Required                                                       â”‚
â”‚        â†³ Returns: { orderId, approvalUrl }                                   â”‚
â”‚                                                                               â”‚
â”‚ POST   /capture-order                                                         â”‚
â”‚        â†³ Capture completed PayPal payment                                    â”‚
â”‚        â†³ Body: { orderId }                                                    â”‚
â”‚        â†³ Auth: Required                                                       â”‚
â”‚        â†³ Returns: { success, captureId, amount, payerId }                    â”‚
â”‚                                                                               â”‚
â”‚ GET    /order/:orderId                                                        â”‚
â”‚        â†³ Get PayPal order details                                            â”‚
â”‚        â†³ Auth: Required                                                       â”‚
â”‚        â†³ Returns: { order details from PayPal }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           SOCKET.IO EVENTS                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Event: contractGenerated
â”œâ”€â”€ Emitted to: Both client and freelancer
â”œâ”€â”€ Payload: { contractId, proposalId }
â””â”€â”€ Trigger: After AI contract generation

Event: contractSigned
â”œâ”€â”€ Emitted to: Other party (not the signer)
â”œâ”€â”€ Payload: { contractId, signedBy: 'client'|'freelancer', fullyExecuted }
â””â”€â”€ Trigger: After signature

Event: milestoneCompleted
â”œâ”€â”€ Emitted to: Client
â”œâ”€â”€ Payload: { contractId, milestoneIndex, milestone }
â””â”€â”€ Trigger: Freelancer marks milestone complete

Event: paymentReceived
â”œâ”€â”€ Emitted to: Freelancer
â”œâ”€â”€ Payload: { contractId, milestoneIndex, amount, totalPaid }
â””â”€â”€ Trigger: Client completes PayPal payment


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          SECURITY & VALIDATION                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… JWT Authentication - All endpoints require valid token
âœ… Role-Based Access - Only contract parties can view/modify
âœ… Action Restrictions:
   â€¢ Only freelancer can mark milestones complete
   â€¢ Only client can approve and pay milestones
   â€¢ Both parties must sign contract
âœ… IP Logging - Records IP address of signers
âœ… Signature Capture - Digital signature from both parties
âœ… Payment Verification - PayPal handles payment security
âœ… Status Validation - Prevents invalid state transitions
âœ… Proposal Check - Contract only for accepted proposals
âœ… Duplicate Prevention - One contract per proposal


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              AI INTEGRATION                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Google Gemini API
â”œâ”€â”€ Model: gemini-2.0-flash (primary)
â”œâ”€â”€ Fallback: gemini-1.5-flash
â”œâ”€â”€ Input: Project details (title, description, skills, amount, timeline)
â”œâ”€â”€ Output: Professional contract with 10 sections:
â”‚   1. Project Scope
â”‚   2. Deliverables
â”‚   3. Payment Terms
â”‚   4. Timeline
â”‚   5. Revisions
â”‚   6. Intellectual Property
â”‚   7. Confidentiality
â”‚   8. Termination
â”‚   9. Dispute Resolution
â”‚   10. Warranties
â””â”€â”€ Fallback: Template contract if AI fails


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            SUCCESS INDICATORS                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Contract generated with AI
âœ… Both parties signed
âœ… Milestones created automatically
âœ… Freelancer completed work
âœ… Client paid via PayPal
âœ… Payment recorded in database
âœ… Real-time notifications sent
âœ… Contract marked as completed
âœ… All data persisted correctly

*/
